!function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(d===clearTimeout)return clearTimeout(e);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function s(){g&&h&&(g=!1,h.length?m=h.concat(m):v=-1,m.length&&c())}function c(){if(!g){var e=a(s);g=!0;for(var t=m.length;t;){for(h=m,m=[];++v<t;)h&&h[v].run();v=-1,t=m.length}h=null,g=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function f(){}var l,d,p=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(e){d=i}}();var h,m=[],g=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new u(e,t)),1!==m.length||g||a(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=f,p.addListener=f,p.once=f,p.off=f,p.removeListener=f,p.removeAllListeners=f,p.emit=f,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],2:[function(e,t,n){!function(e){function n(){}function r(e,t){return function(){e.apply(t,arguments)}}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(e,this)}function a(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void i._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null===n)return void(1===e._state?o:s)(t.promise,e._value);var r;try{r=n(e._value)}catch(e){return void s(t.promise,e)}o(t.promise,r)}))}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void c(e);if("function"==typeof n)return void f(r(n,t),e)}e._state=1,e._value=t,c(e)}catch(t){s(e,t)}}function s(e,t){e._state=2,e._value=t,c(e)}function c(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)a(e,e._deferreds[t]);e._deferreds=null}function u(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function f(e,t){var n=!1;try{e(function(e){n||(n=!0,o(t,e))},function(e){n||(n=!0,s(t,e))})}catch(e){if(n)return;n=!0,s(t,e)}}var l=setTimeout;i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var r=new this.constructor(n);return a(this,new u(e,t,r)),r},i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,n){function r(a,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var s=o.then;if("function"==typeof s)return void s.call(o,function(e){r(a,e)},n)}t[a]=o,0===--i&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var i=t.length,a=0;a<t.length;a++)r(a,t[a])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(e){return new i(function(t,n){n(e)})},i.race=function(e){return new i(function(t,n){for(var r=0,i=e.length;r<i;r++)e[r].then(t,n)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){l(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},i._setImmediateFn=function(e){i._immediateFn=e},i._setUnhandledRejectionFn=function(e){i._unhandledRejectionFn=e},"undefined"!=typeof t&&t.exports?t.exports=i:e.Promise||(e.Promise=i)}(this)},{}],3:[function(e,t,n){t.exports={name:"jet-app-containershim",version:"1.2.0",description:"Handles messaging & subscriptions to EikonJET.",scripts:{test:"nyc --reporter=html babel-node spec/babel_spec_runner.js","test:bundle":"browserify spec/spec/specs.js -o spec/browser/test.bundle.js -t [ babelify --presets [ es2015 ] ]","test:debug":"node %NODE_DEBUG_OPTION% node_modules/jasmine/bin/jasmine JASMINE_CONFIG_PATH=spec/support/jasmine.json",lint:"jshint src","build:dev":"node ./buildScripts/dev.js","build:production":"node ./buildScripts/production.js",build:"npm run build:dev && npm run build:production",clean:"rimraf dist/*"},repository:{type:"git",url:"git+https://github.com/thomsonreuters/jet-app-containershim.git"},bugs:{url:"https://github.com/thomsonreuters/jet-app-containershim/issues"},homepage:"https://github.com/thomsonreuters/jet-app-containershim#readme",devDependencies:{"babel-cli":"6.11.4","babel-plugin-istanbul":"1.0.3","babel-preset-es2015":"6.9.0",babelify:"7.3.0",browserify:"^13.1.1",chalk:"^1.1.3",exorcist:"^0.4.0","file-system":"^2.2.2",istanbul:"0.4.4",jasmine:"2.4.1",jsdom:"8.2.0",jshint:"^2.9.4",mversion:"1.10.1",nyc:"8.1.0","promise-polyfill":"^6.0.2",rimraf:"2.5.2",sinon:"1.17.5","uglify-js":"^2.7.4",xmldom:"0.1.22"},nyc:{exclude:["spec/setup.js","spec/babel_spec_runner.js","spec/mocks/**/*.js","spec/spec/*spec.js"],sourceMap:!1,instrument:!1}}},{}],4:[function(e,t,n){function r(e){e=e||{},w=e.isWeb||!1,u=e.eikonNow,s=e.frameManager,f=e.aWindow,this.frames={},this.version=l,this.eventMap={},this.jetToMap={onLog:{},onLoad:{},onPropertyChange:{},onNavigate:{},onContextChange:{},onUnload:{},Session:{},onSaveToStore:{},persistdata:{}},this.jetFromMap={onContextChange:{},onPropertyChange:{},Description:{},UserInfo:{},ContainerInformation:{},fromTransferData:{}},p(this,s.isDesktop()),this.init(e)}function i(){return E++}function a(e,t){return String.prototype.startsWith?e.startsWith(t):e.slice(0,t.length)===t}var o,s,c,u,f,l=e("../package.json").version,d=e("./DesktopXML"),p=e("./Logger"),h=e("./windowEvents"),m=e("./AppContainerThin"),g=e("./boundObjects"),v=void 0,y=!1,_="unknown"+500*Math.random(),b=null,w=!1,E=1;r.prototype={getIdsOnChannel:function(e){if(e)return this.eventMap[e]},addIdToChannel:function(e,t){if(e&&t){var n=this.getIdsOnChannel(t);return n?n.push(e):this.eventMap[t]=[e]}},setTopACSRegistered:function(){y=!0,this.__registering=!1},init:function(){var e=this;this._bindDesktopXML(d(f)),o=g();try{c||(c=function(){e.unRegister(),h.removeEvent(f.top,"unload",c)},h.addEvent(f.top,"unload",c))}catch(n){var t=function(){e.unRegister(),h.removeEvent(f,"unload",t)};h.addEvent(f,"unload",t)}},setBus:function(e){v=e},findContainer:function(e){function t(e){try{return(e.registerWithCCFContainer||e.registerWithAsyncCCFContainer||e.registerWithJET||e.eikonLinkReady)&&"function"==typeof(e.registerWithCCFContainer||e.registerWithAsyncCCFContainer||e.registerWithJET||e.eikonLinkReady)}catch(e){return!1}}return t(e)?e:e.parent&&e.parent!==e?this.findContainer(e.parent):window},_registerJETApp:function(e){var t,n=this,r={jet_data:e},i={},a=new Promise(function(e,t){i.resolve=e,i.reject=t}),o=e.xmlData&&e.xmlData.appId?e.xmlData.appId:null;if(!u||u&&!u.isEnabled()){try{var s=f.top.registerWithJET}catch(e){}if(e.xmlData=this._toContainer("Session",e.xmlData).xmlData,s){var c=this.findContainer(f);c.onCEFChannel=function(e){try{n._eikonJET=f.top.EikonJET}catch(e){}n._initJETApp(e).then(function(e){r.containerDescription=e,n.loggingSource&&n.loggingSource("JET_APP_CONTAINER"),n.getPersistedJETData().then(function(e){r._topLevel=!0,r.persistData=e;try{_=r.containerDescription.windowInfo.windowId}catch(e){n.debug("no windowId, stability may suffer"),_=null}try{var t=JSON.parse(r.containerDescription.properties[1].AppInfo);b=t.AppId}catch(e){b=null,!o||"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||(b=o),n.debug("appId is ",b?b:"null")}n._eikonJET.onMessage(n._onProcessEvent.bind(n)),n._eikonJET.onRequest(n._onGetData.bind(n)),n.debug("_registerJETApp: ",r),i.resolve(r)},function(e){i.reject(e)})})};var l=JSON.stringify(e).replace(/\\/g,"\\\\\\");s(l),this.setTopACSRegistered(!0)}else i.reject("could not find registerWithJET function")}else u&&u.isEnabled()?(t={JETAppData:e,dfd:i},m.call(n,t),this.setTopACSRegistered(!0)):i.reject("could not register with JET (no registerWithJETCall and no EikonWeb)");return a},_initJETApp:function(e){var t=this._fromContainerData("Description",e);if(t){if(!this._eikonJET){var n;n=document.createElement("embed"),n.type="application/x-jetPlugin",n.width=0,n.height=0,n.id="jetPlugin",n.style.position="absolute",n.style.opacity="0",document.body.appendChild(n),this._eikonJET=n.jetPlugin()}this._eikonJET.init(t.plugin.channel),this.debug("App Container registered with EikonJET!")}return new Promise(function(e,n){t?e(t):n("could not get container description.")})},getPersistedJETData:function(){var e=this;return new Promise(function(t,n){e.getData({name:"persistdata",xmlData:null,async:function(e){t(e)}})})},_bindDesktopXML:function(e){this.jetFromMap=e.fromMap,this.jetToMap=e.toMap},_fromContainer:function(e,t){var n=this.jetFromMap,r=t?{name:e,data:t}:e;return{name:r.name,data:n[r.name]&&n[r.name].format?n[r.name].format(r.data||r.xmlData):r.data||r.xmlData,channel:r.channel}},_fromContainerData:function(e,t){return this._fromContainer(e,t).data},_fromContainerAsync:function(e,t,n){var r=this;return new Promise(function(n,i){n(r._fromContainer(e,t))})},_toContainer:function(e,t){var n=this.jetToMap,r=t?{name:e,data:t}:e;return{name:r.name,xmlData:n[r.name]&&n[r.name].format?n[r.name].format(r.data):r.data,channel:r.channel,target:r.target||"",pipe:r.pipe||!1,instanceId:r.instance||""}},_toContainerAsync:function(e,t){var n=this;return new Promise(function(r,i){r(n._toContainer(e,t))})},_publish:function(e){e=e||{},this.debug("_publish: "+JSON.stringify(e)),this._processEvent(void 0,{name:"Publish",data:e.data,channel:e.channel})},_publishWithPipeTarget:function(e){e=e||{},this.debug("_publishWithPipeTarget: ",+JSON.stringify(e));var t={name:"Publish",data:e.data,channel:e.channel,target:e.target,pipe:e.pipe||!1};if(e.target)try{var n={};n=JSON.stringify({targetData:t.data,targetId:e.target}),t.data=n}catch(e){}this._processEvent(void 0,t)},_send:function(e){e=e||{},this._processEvent(void 0,{name:"Publish",data:e.data,channel:e.channel,target:e.target,pipe:!0})},_registerFrame:function(e){var t=e,n=i();return this._setFrame(n,t)},_getFrame:function(e){for(var t=Object.keys(this.frames),n=t.length,r=void 0,i=0;i<n;i++)if(e===this.frames[t[i]].window){r=this.frames[t[i]];break}return r},_setFrame:function(e,t){return this.frames[e]={id:e,window:t},this.frames[e]},_removeFrame:function(e){return delete this.frames[e],this},_mapEventToFrame:function(e,t){if(t){var n=this.getIdsOnChannel(t);if(n){for(var r=!1,i=n.length,a=0;a<i;a++){var o=n[a];if(e===o){r=!0;break}}r||n.push(e)}else n=this.addIdToChannel(e,t)}return n},_subscribeWithPipe:function(e,t){var n=this._getOrRegisterSource(e),r=this._mapEventToFrame(n.id,t.channel);this._emitSubscribeWithPipe(r,t)},_emitSubscribeWithPipe:function(e,t){if(e&&!e.isProcessed){var n={name:"Subscribe",channel:t.channel,pipe:!0};this._processEvent(void 0,n),e.isProcessed=!0}},_subscribeWithPipeTarget:function(e,t){var n=this._getOrRegisterSource(e),r=this._mapEventToFrame(n.id,t.channel);this._emitSubscribeWithPipeTarget(r,t)},_emitSubscribeWithPipeTarget:function(e,t){if(e&&!e.isProcessed){var n={name:"Subscribe",channel:t.channel,target:t.target,pipe:!0};if(this._processEvent(void 0,n),t.requestSubscribeWithPipe){var r=t.requestSubscribeWithPipe,i={channel:t.channel,target:t.target,data:t.data};this._processEvent(void 0,{name:"Publish",data:JSON.stringify(i),target:t.target,channel:r.channel,pipe:!0})}e.isProcessed=!0}},_subscribe:function(e,t){this.debug("_subscribe: "+JSON.stringify(t));var n=this._getOrRegisterSource(e),r=t.channel,i=this._mapEventToFrame(n.id,r);this._emitSubscribe(i,r)},_emitSubscribe:function(e,t){if(e&&!e.isProcessed){var n={name:"Subscribe",data:"",channel:t};this._processEvent(void 0,n),e.isProcessed=!0}},_unsubscribe:function(e,t){var n=this._getFrame(e);if(n){var r=t.channel,i=this.getIdsOnChannel(r);if(i){var a=i.indexOf(n.id);a>=0&&i.splice(a,1),this._emitUnsubscribe(t)}}},_emitUnsubscribe:function(e){var t=e.channel;0===this.getIdsOnChannel(t).length&&(this._processEvent(void 0,e),delete this.eventMap[t])},_wrapAsync:function(e){if(e&&e.async){var t=e.async,n=this;e.async=function(r){t(r?n._fromContainer(e.name,r):r)}}},_processEvent:function(e,t){if(this._wrapAsync(t),t=this._toContainer(t),a(t.target,"!")&&t.xmlData)try{var n=JSON.parse(t.xmlData);n.instanceId=_,n.appId=b,t.xmlData=JSON.stringify(n)}catch(e){}if("onUnload"===t.name&&(this.setTopACSRegistered(!1),e)){var r=this._getFrame(e);r&&this._removeFrame(r.id)}t=JSON.stringify({name:t.name,data:t.xmlData,method:"processEvent",channel:t.channel,pipe:t.pipe||!1}),this._eikonJET.post(t)},_onProcessEvent:function(e){var t;this.debug("_onProcessEvent: "+JSON.stringify(e)),"string"==typeof e&&(e=JSON.parse(e)),e=this._fromContainer(e);try{var n=JSON.parse(e.data),r=n.target,i=n.targetId;if(r||i)return i?void((i===_||a(i,"!"))&&(e.data=n.targetData,this._sendProcessEventMessage(e))):a(r,"!")?(t=n.instanceId,void((t===_||a(r,"!"))&&this._sendProcessEventMessage(e))):void 0}catch(e){}this._sendProcessEventMessage(e)},_sendProcessEventMessage:function(e){var t=this.getIdsOnChannel(e.channel),n=this;if(t)t.forEach(function(t){var r=n.frames[t].window;v.sendMessage(r,{parseKey:"jet:msg",params:[e],funcName:"doEvent"})});else if(""===e.channel)for(var r=this.frames,i=Object.keys(r),a=i.length,o=0;o<a;o++){var s=r[i[o]];v.sendMessage(s.window,{parseKey:"jet:msg",params:[e],funcName:"doEvent"})}else try{if(w)v.sendMessage(f,{funcName:"doEvent",params:[e]});else if(f.top.frames.length)for(var c=f.top,u=c.frames.length,o=0;o<u;o++){for(var l=c.frames[o],i=Object.keys(this.frames),d=i.length,p=!1,h=0;h<d;h++)if(l===this.frames[i[h]].window){p=!0;break}if(!p&&l.JET&&l.JET.callEventHandler)try{l.JET.callEventHandler(e)}catch(e){}}}catch(e){}},_onProcessEventWithSource:function(e,t){var t=this._fromContainer(t);v.sendMessage(e,{parseKey:"jet:msg",params:[t],funcName:"doEvent"})},getData:function(e){var t=this;return new Promise(function(n,r){t._wrapAsync(e);var i,a=JSON.stringify({name:e.name,data:e.xmlData,method:"getData"});try{i=t._eikonJET.send(a)}catch(e){r(e)}e.async&&e.async(i),i&&(i=t._fromContainerData(e.name,i)),n(i)})},_onGetData:function(e){var t={};if("string"==typeof e&&(t=JSON.parse(e)),!t.name)return null;var n=o.dataProviders[t.name];if(null!=n){var r=n.call(this,t.xmlData);return this._toContainer(t.name,r).xmlData}return null},_setLoggingLevel:function(e){this.setLogOptions(e)},_setBoundedProp:function(e){var t=o[e.name];t&&t.hasOwnProperty(e.key)&&(t[e.key]=e.value)},_getBoundedProp:function(e,t){return o[e][t]},_getOrRegisterSource:function(e){var t=this._getFrame(e);return t||(t=this._registerFrame(e)),t},_unload:function(){var e=this;return this.getPersistedJETData().then(function(t){e._processEvent(void 0,{data:t,name:"onUnload"})})},unRegister:function(){y&&(this.unsubscribeAll(),this._unload().then(function(){"undefined"!=typeof v&&v.dispose&&v.dispose(),y=!1}))},unsubscribeAll:function(){for(var e=Object.keys(this.eventMap),t=e.length,n=0;n<t;n++){var r=e[n];this._processEvent(void 0,{name:"Unsubscribe",data:"",channel:r})}this.eventMap={}}},t.exports=r},{"../package.json":3,"./AppContainerThin":6,"./DesktopXML":7,"./Logger":8,"./boundObjects":11,"./windowEvents":14}],5:[function(e,t,n){function r(e,t){if(!e||!t)throw new Error("AppContainerShim needs a resolve & reject to load");p?setTimeout(function(){a(e,t)},50):(p++,a(e,t))}function i(){d.__ACS__&&(p=0,d.__ACS__.unRegister(),u.setOnFrame("__initACS__",void 0,!0),u.setOnFrame("__unRegisterACS__",void 0,!0))}function a(e,t){var n={};1===p&&(p++,n={register:!0},o()),e(n)}function o(){var e,t=!u.isDesktop();d.__ACS__=new l({isWeb:t,frameManager:u,aWindow:s,eikonNow:c}),e=new f(d,{sameWindowStrategy:t,frameManager:u}),d.__ACS__.setBus(e),e.addStringToParser("jet:msg"),e.registerNamespace(d.__ACS__)}var s,c,u,f,l,d,p=0;t.exports=function(e){l=e.ACS,c=e.eikonNow,s=e.aWindow,f=e.MessageManager,u=e.frameManager,d=u.getFrame(),u.setOnFrame("__initACS__",r),u.setOnFrame("__unRegisterACS__",i)}},{}],6:[function(e,t,n){function r(e){var t=e.getData({name:"ContainerInformation",xmlData:null})||{};return t.GUID}function i(e){f=this._toContainer("persistdata",e.persist).xmlData}function a(e){"resolved"!==d?(e.xmlData&&(g.persistData=JSON.parse(e.xmlData).persist),d.resolve(g),d="resolved"):i.call(this,e)}function o(e){var t=void 0,n=null;return e&&(t=e.name),new Promise(function(r,i){try{"persistdata"===t?n=f:(n=c.getData(e),n&&(n=l._fromContainerData(t,n)))}catch(t){i('getData({"name":"'+e.name+'"} throws Exception : "'+t.message+'"')}e.async&&e.async(n),r(n)})}function s(e){"[object String]"===Object.prototype.toString.call(e)&&(e=JSON.parse(e)),e.channel===p?a.call(this,e,u.ID):this._onProcessEvent(e)}var c,u,f,l,d,p="/navigation/archive_response",h="/navigation/archive_request",m=void 0,g={};t.exports=function(e){e=e||{},u=e.JETAppData||"",d=e.dfd;var t=l=this;c=registerWithCCFContainer({getData:t._onGetData,processEvent:s.bind(t)},u.xmlData),m=c.$$id,g._topLevel=!0,g.Initialized=null!==c,g.ContainerType="Sync",this.getData=o,this._processEvent=function(e,n){if(e&&e instanceof Window){var r=t._toContainer(n);c.processEvent(r)}else if(e&&void 0===n){var r=t._toContainer(e);c.processEvent(r)}else{var r=t._toContainer(n);c.processEvent(r)}};var n=c.getData({name:"description",xmlData:""});null!==n&&(g.containerDescription=this._fromContainerData("Description",n)),g.GUID=r(c),c.processEvent({name:"Subscribe",data:"",channel:p}),c.processEvent(this._toContainer({name:"Publish",data:JSON.stringify({id:u.ID,url:window.location.href}),channel:h}))}},{}],7:[function(e,t,n){function r(e){function t(e){function t(e,t){for(var n in t)e[n]=t[n];return e}for(var n=1,r=arguments.length;n<r;n++)t(e||{},arguments[n]);return e}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n],i=null,a=null;if(r.name)i=r.name,a=r.text||r.value||"";else for(var o in r)if(r.hasOwnProperty(o)){i=o,a=r[o]||"";break}null!=i&&null!=a&&(e[i]={value:a,type:r.type||"xs:string",access:"ro"===r.access?"ro":"rw"})}}function r(e){return"<![CDATA["+i(e)+"]]>"}function i(e){var t=/\<\!\[CDATA\[|\]\]\>/gi;return e.replace(t,"")}function a(e,t){return void 0!==e&&e===e&&("array"==t?Array.isArray(e):typeof e===t)}function o(e,t,n){Array.isArray(t)||(t=[t]),t.forEach(function(t){if(!a(e[t],n))throw new Error(t+" field is not specified!")})}function s(e,t,n,r){void 0!==n&&null!==n||(n=1),void 0!==r&&null!==r||(r=Number.POSITIVE_INFINITY),Array.isArray(t)||(t=[t]),t.forEach(function(t){if(a(e[t],"array")&&(e[t].length<n||e[t].length>r))throw new Error("Array "+t+" out of range("+n+", "+r+")")})}function c(e,t){for(var n=0;n<t.length;n++)if(e==t[n])return;throw new Error("Field has invalid value: "+e)}function u(e){return e.indexOf("<![CDATA[")>-1?e:(e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&apos;"))}function f(e,t){var n="<"+e;return a(t.x,"number")&&(n+=' x="'+t.x+'"'),a(t.y,"number")&&(n+=' y="'+t.y+'"'),a(t.width,"number")&&(n+=' width="'+t.width+'"'),a(t.height,"number")&&(n+=' height="'+t.height+'"'),a(t.relative,"boolean")&&(n+=' relative="'+t.relative+'"'),n+=" />"}function l(e,t){var n="<"+e+">";return t.aUrl&&(n+='<Anchor url="'+u(t.aUrl)+'" />'),t.imgUrl&&(n+='<Image url="'+u(t.imgUrl)+'" />'),t.mouse&&(n+=d("Mouse",t.mouse)),t.entities&&t.entities.length&&(n+=h("Entities",t.entities)),t.menu&&(n+=A("ContextMenu",t.menu)),n+="</"+e+">"}function d(e,t){var n="<"+e;return a(t.screenX,"number")&&(n+=' screenx="'+t.screenX+'"'),a(t.screenY,"number")&&(n+=' screeny="'+t.screenY+'"'),a(t.clientX,"number")&&(n+=' clientx="'+t.clientX+'"'),a(t.clientY,"number")&&(n+=' clienty="'+t.clientY+'"'),n+" />"}function p(e,n){var r={};t(r,n);var i="<"+e;if(a(r.type,"string")&&(i+=' type="'+u(r.type)+'"'),delete r.type,a(r.dataSource,"string")&&(i+=' datasource="'+u(r.dataSource)+'"'),i+=">",delete r.dataSource,r.fields)for(var s in r.fields)i+='<Field name="'+u(s)+'">',a(r.fields[s],"string")&&(i+=u(r.fields[s])),i+="</Field>";delete r.fields,r.entities&&(o(r,"entities","array"),r.entities.forEach(function(e){i+=p("Entity",e)})),delete r.entities;for(var c in r)c in{NavigationNS:"",SelectionNS:"",Transaction:""}?(i+='<Field name="'+u(c)+'">',a(r[c],"string")&&(i+=u(r[c])),i+="</Field>"):"IdentifierList"!==c&&"FieldList"!==c&&(i+='<Identifier namespace="'+u(c)+'">',a(r[c],"string")&&(i+=u(r[c])),i+="</Identifier>");return i+="</"+e+">"}function h(e,t){var n="<"+e+">";return t.length>0&&t.forEach(function(e){n+=p("Entity",e)}),n+="</"+e+">"}function m(e){o(e,"id","string");var t=' ID="'+u(e.id)+'"';return a(e.tooltip,"string")&&(t+=' tooltip="'+u(e.tooltip)+'"'),a(e.icon,"string")&&(t+=' icon="'+u(e.icon)+'"'),a(e.enabled,"boolean")&&(t+=' enabled="'+e.enabled+'"'),a(e.description,"string")&&(t+=' description="'+u(e.description)+'"'),a(e.iconURL,"string")&&(t+=' iconURL="'+u(e.iconURL)+'"'),a(e.beginGroup,"boolean")&&(t+=' beginGroup="'+e.beginGroup+'"'),a(e.groupName,"string")&&(t+=' groupName="'+u(e.groupName)+'"'),t}function g(e){var t=m(e);return o(e,"caption","string"),t+=' caption="'+u(e.caption)+'"',a(e.checked,"boolean")&&(t+=' checked="'+e.checked+'"'),a(e.type,"string")&&(c(e.type,["iconOnly","iconAndCaption","captionOnly"]),t+=' type="'+e.type+'"'),t}function v(e){var t=m(e);return a(e.caption,"string")&&(t+=' caption="'+u(e.caption)+'"'),t}function y(e){var t="<Button"+g(e)+" />";return t}function _(e){var t="<SystemMenu"+x(e)+" />";return t}function b(e){var t="<ComboBox"+v(e);return a(e.type,"string")&&(c(e.type,["dropDown","comboBox"]),t+=' type="'+e.type+'"'),a(e.dropDownWidth,"number")&&(t+=' maxlength="'+e.dropDownWidth+'"'),t+=" >",e.items&&e.items.forEach(function(e){o(e,"caption","string"),t+='<ListItem caption="'+u(e.caption)+'"',a(e.selected,"boolean")&&(t+=' selected="'+e.selected+'"'),a(e.id,"string")&&(t+=' ID="'+u(e.id)+'"'),t+=" />"}),t+="</ComboBox>"}function w(e){var t="";return e.items&&e.items.forEach(function(e){switch(o(e,"item","string"),e.item){case"Button":t+=y(e);break;case"SplitButton":t+=E(e);break;case"Menu":t+=D(e);break;case"Separator":t+=S(e);break;default:throw new Error("Invalid item type specified: "+e.item)}}),t}function E(e){var t="<SplitButton"+g(e)+">";return o(e,"items","array"),s(e,"items"),e.items&&(t+=w(e)),t+="</SplitButton>"}function D(e){var t="<Menu"+g(e)+">";return o(e,"items","array"),s(e,"items"),e.items&&(t+=w(e)),t+="</Menu>"}function x(e){o(e,"id","string");var t=' ID="'+u(e.id)+'"';return a(e.enabled,"boolean")&&(t+=' enabled="'+e.enabled+'"'),a(e.visible,"boolean")&&(t+=' visible="'+e.visible+'"'),s(e,"items"),e.items&&(t+=_(e)),t}function C(e){var t="<Search";return a(e.id,"string")&&(t+=' ID="'+u(e.id)+'"'),t+="/>"}function S(e){var t="<Separator />";return t}function P(e){var t="<Edit"+v(e);if(a(e.text,"string")&&(t+=' text="'+u(e.text)+'"'),a(e.maxLength,"number")){if(e.maxLength<0)throw new Error("Negative value was used for maxLength: "+e.maxLength);t+=' maxlength="'+e.maxLength+'"'}return t+=" />"}function T(e){o(e,"id","string"),c(e.id,["PRINT"]);var t='<Print ID="PRINT" />';return t}function I(e,t){var n="<"+e;return a(t.caption,"string")&&(n+=' caption="'+u(t.caption)+'"'),a(t.category,"number")&&(n+=' category="'+t.category+'"'),n+=">",o(t,"items","array"),s(t,"items"),t.items&&t.items.forEach(function(e){switch(o(e,"item","string"),e.item){case"Button":n+=y(e);break;case"SplitButton":n+=E(e);break;case"Menu":n+=D(e);break;case"Separator":n+=S(e);break;case"Search":n+=C(e);break;case"Edit":n+=P(e);break;case"ComboBox":n+=b(e);break;case"Print":n+=T(e);break;case"System":n+=_(e);break;case"Header":break;default:throw new Error("Invalid item type specified: "+e.item)}}),n+="</"+e+">"}function N(e,t){var n="<"+e+">";return t.commandBarType&&Array.isArray(t.commandBars)&&(n+=A(t.commandBarType,t.commandBars)),n+="</"+e+">"}function A(e,t){var n="<"+e+">";return Array.isArray(t)&&t.forEach(function(e){n+=I("CommandBar",e)}),n+="</"+e+">"}function M(e,t){var n="<Property";return t.type&&(n+=' type="'+u(t.type)+'"'),t.access&&(n+=' access="'+t.access+'"'),e&&(n+=' name="'+u(e)+'">'),t.value&&(n+=u(t.value)),n+="</Property>"}function k(e,t){var n="<"+e+">";for(var r in t)t.hasOwnProperty(r)&&(n+=M(r,t[r]));return n+="</"+e+">"}function j(e){var t="<PData";return a(e.name,"string")&&(t+=' name="'+u(e.name)+'"'),t+=">",a(e.value,"string")&&(t+=r(e.value)),t+="</PData>"}function O(e,t){t=t||[];var n="<"+e,r=Array.isArray(t)?t:t.data;return a(t.service,"string")&&(n+=' service="'+u(t.service)+'"'),a(t.title,"string")&&(n+=' title="'+u(t.title)+'"'),a(t.extension,"string")&&(n+=' extension="'+u(t.extension)+'"'),n+=">",a(t.cpurl,"string")?(n+='<Url cpurl="'+u(t.cpurl)+'">',n+=u(a(t.url,"string")?t.url:t.cpurl),n+="</Url>"):a(t.url,"string")&&(n+="<Url>"+u(t.url)+"</Url>"),r&&r.forEach(function(e){n+=j(e)}),n+="</"+e+">"}function F(e,t){var r="<"+e;if(a(t.url,"string")&&(r+=' url="'+u(t.url)+'"'),a(t.name,"string")&&(r+=' name="'+u(t.name)+'"'),a(t.target,"string")&&(r+=' target="'+t.target+'"'),r+=">",t.entities&&(r+=h("Entities",t.entities)),t.archive&&(r+=O("PersistData",t.archive)),t.location&&(r+=f("Location",t.location)),t.properties){var i={};n(i,t.properties),r+=k("Properties",i)}return r+="</"+e+">"}function J(e,t){var n="<"+e;return t.mouse&&(a(t.mouse.screenX,"number")&&(n+=' screenx="'+t.mouse.screenX+'"'),a(t.mouse.screenY,"number")&&(n+=' screeny="'+t.mouse.screenY+'"')),n+=">",t.entities&&t.entities.length&&(n+='<Data type="ContextData">',n+=h("Entities",t.entities),n+="</Data>"),t.archive&&(n+='<Data type="PersistData">',n+=O("PersistData",t.archive),n+="</Data>"),n+="</"+e+">"}function L(e,t){var n="<"+e;return a(t.multipleMatches,"boolean")&&(n+=' multipleMatches="'+t.multipleMatches+'"'),a(t.contextResolution,"boolean")&&(n+=' contextResolution="'+t.contextResolution+'"'),n+=">",t.constraints&&t.constraints.forEach(function(e){o(e,"namespace","string"),n+='<Constraint namespace="'+e.namespace+'">',null!==e.contextDataTransformation&&void 0!==e.contextDataTransformation&&(n+="<ContextDataTransformation>"+e.contextDataTransformation+"</ContextDataTransformation>"),e.definitions&&e.definitions.forEach(function(e){n+="<Definition",a(e.name,"string")&&(n+=' name="'+u(e.name)+'"'),n+=">",a(e.value,"string")&&(n+=u(e.value)),n+="</Definition>"}),n+="</Constraint>"}),n}function R(e,t){var n="<"+e+">";return a(t.summary,"string")&&(n+="<Summary>"+u(t.summary)+"</Summary>"),t.toolbar&&(n+=A("Toolbar",t.toolbar.commandBars)),t.serviceMenu&&(n+=A("ServiceMenu",t.serviceMenu)),t.apptitlebar&&(n+=A("AppTitleBar",t.apptitlebar)),t.appmenu&&(n+=A("AppMenu",t.appmenu)),t.entities&&t.entities.length&&(n+=h("Context",t.entities)),t.searchTarget&&(n+=L("SearchTarget",t.searchTarget)),t.properties&&(n+=k("Properties",t.properties)),n+="</"+e+">"}function W(e,t){var n="<"+e+">";return o(t,"messages","array"),s(t,"messages"),t.messages.forEach(function(e){o(e,"text","string"),n+="<Message",a(e.severity,"string")&&(c(e.severity,["critical","high","warning","information","debug"]),n+=' severity="'+e.severity+'"'),a(e.text,"string")&&(n+=' text="'+u(e.text)+'"'),a(e.source,"string")&&(n+=' source="'+u(e.source)+'"'),n+=" />"}),n+="</"+e+">"}function U(e,t){var n="<"+e+">";return t.entries.forEach(function(e){o(e,"name","string"),n+='<Entry name="'+u(e.name)+'">',a(e.value,"string")&&(n+=u(e.value)),n+="</Entry>"}),n+="</"+e+">"}function B(e,t){o(t,"id","string");var n="<"+e+' ID="'+u(t.id)+'"';return a(t.value,"string")&&(n+=' value="'+u(t.value)+'"'),a(t.duration,"number")&&(n+=' duration="'+t.duration+'"'),n+=">",o(t,"title","string"),n+="<Title>"+u(t.title)+"</Title>",a(t.message,"string")&&(n+="<Message>"+u(t.message)+"</Message>"),a(t.icon,"string")&&(n+="<Icon>"+u(t.icon)+"</Icon>"),a(t.iconUrl,"string")&&(n+="<IconUrl>"+u(t.iconUrl)+"</IconUrl>"),n+="</"+e+">"}function H(e,t){o(t,"version","string"),o(t,"id","string");var n=new RegExp("^[0-9]+\\.[0-9]+\\.[0-9]+$");if(!n.test(t.version))throw new Error("Invalid version was specified: "+t.version);var r="<"+e+' version="'+t.version+'" ID="'+u(t.id)+'"/>';return r}function X(e,t){var n="<"+e;return t.title&&(n+=' title="'+u(t.title)+'"'),t.category&&(n+=' category="'+u(t.category)+'"'),t.path&&(n+=' path="'+u(t.path)+'"'),n+=">",n+="<PData>",n+='<SearchTarget xmlns="http://www.reuters.com/ns/2005/06/21/ccf">',t.constraints&&Array.isArray(t.constraints)&&t.constraints.forEach(function(e){n+="<Constraint",e.namespace&&(n+=' namespace="'+u(e.namespace)+'"'),n+=">",e.definitions&&Array.isArray(e.definitions)&&e.definitions.forEach(function(e){n+="<Definition",e.viewId&&(n+=' viewId="'+u(e.viewId)+'"'),n+=">";var t=function(e){var n="";return Array.isArray(e)&&e.forEach(function(e){n+="<Property",e.name&&(n+=' name="'+u(e.name)+'"'),n+=">",e.properties?n+=t(e.properties):e.value&&(n+=u(e.value)),n+="</Property>"}),n};e.properties&&(n+=t(e.properties)),n+="</Definition>"}),n+="</Constraint>"}),n+="</SearchTarget>",n+="</PData>",n+="</"+e+">"}function K(e){var t;try{t=ie.parseFromString(e,"text/xml")}catch(e){throw new Error("invalid xml!")}return t&&t.documentElement?t.documentElement:null}function G(e,t,n,r,i){return t=Array.isArray(t)?t:[t],i=i?Array.isArray(i)?i:[i]:t,t.forEach(function(t,n){var a=e.getAttribute(t);a&&(r[i[n]]=a)}),r}function Y(e){var t={};G(e,["type","datasource"],!1,t,["type","dataSource"]),t.IdentifierList=[],t.FieldList=[];for(var n=0;n<e.childNodes.length;n++){var r,i=e.childNodes.item(n);switch(i.tagName){case"Identifier":r={},G(i,"namespace",!0,r),t[r.namespace]=i.text||i.textContent||"",t.IdentifierList.push(r.namespace);break;case"Field":void 0!==t.fields&&null!==t.fields||(t.fields={}),r={},G(i,"name",!0,r);var a=r.name;switch(delete r.name,r[a]=i.text||i.textContent||"",t.FieldList.push(a),a){case"SelectionNS":case"NavigationNS":case"Transaction":t[a]=r[a];break;default:t.fields[a]=r[a]}break;case"Entity":void 0!==t.entities&&null!==t.entities||(t.entities=[]),t.entities.push(Y(i));break;default:return}}return t}function q(e){for(var t=[],n=0;n<e.childNodes.length;n++){var r=e.childNodes.item(n);switch(r.nodeName){case"Entity":t.push(Y(r))}}return t}function V(e){return G(e,["itemID","value","ID"],!1,{},["itemId","value","id"])}function z(e){var t=[];if("Properties"!=e.tagName)throw new Error("Properties node expected!");for(var n=[],r=0;r<e.childNodes.length;r++){var i=e.childNodes.item(r);switch(i.nodeName){case"Property":var a=i.getAttribute("name"),o=G(i,["type","access"],!1,{});o[a]=i.text||i.textContent||"",n.push(o)}}return n.length>0&&(t=n),t}function $(e){for(var t=G(e,["url","service","title","extension"],!1,{}),n=[],r=0;r<e.childNodes.length;r++){var i=e.childNodes.item(r);switch(i.nodeName){case"Url":t.url=i.text||i.textContent||"",G(i,"cpurl",!1,t);
break;case"PData":var a=G(i,"name",!1,{}),o=i.firstChild;if("context"==a.name)if(null!==o&&void 0!==o&&o.xml)a.value=o.xml;else{a.value="";for(var s=new XMLSerializer,c=0;c<i.childNodes.length;c++){var u=i.childNodes.item(c);a.value+=s.serializeToString(u)}}else null!==o&&void 0!==o?a.value=i.text||i.textContent||"":a.value="";n.push(a)}}return n.length>0&&(t.data=n),t}function Q(e){var t=G(e,["name","logLevel","version","containerVersion","productVersionInfo","userAgent","guid"],!1,{}),n={Capabilities:function(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes.item(n),i=G(r,["name","namespace","type"],!1,{});a(i.type,"string")&&c(i.type,["SYNC","ASYNC","BOTH"]);var o=r.text||r.textContent||"";o.length>0&&(i.value=o),t.capabilities[i.name]=i,delete i.name}},JetPluginInfo:function(e,t){var n={};G(e,"ChannelName",!0,n,"channel"),t.plugin=n},HttpHandler:function(e,t){var n={};G(e,"url",!0,n,"value"),t.GUID=n.value.substring(n.value.indexOf("id=")+3),n.value=n.value.substring(0,n.value.indexOf("?id=")),t.capabilities.httpGetData=n},Properties:function(e,t){t.properties=z(e)},WindowInfo:function(e,t){var n=G(e,["windowId","isFlexViewer"],!0,{});n.isFlexViewer="true"===n.isFlexViewer,n.windowId=n.windowId,n.windowId&&("{"===n.windowId.charAt(0)&&(n.windowId=n.windowId.replace("{","")),"}"===n.windowId.charAt(n.windowId.length-1)&&(n.windowId=n.windowId.replace("}","")),n.windowId=n.windowId.toLowerCase()),t.windowInfo=n}};t.guid&&(t.GUID=t.guid.replace(/-/g,""),delete t.guid),t.capabilities={};for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes.item(r);3!=i.nodeType&&n[i.nodeName].call(this,i,t)}return t}function Z(e){var t={};if("UserInfo"!=e.tagName)throw new Error("UserInfo node expected!");for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes.item(n);if(1==r.nodeType){var i=r.text||r.textContent||"";t[r.tagName]=i}}return t}function ee(e){var t={};if("ContainerInfo"!=e.tagName)throw new Error("ContainerInfo node expected!");return G(e,"GUID",!0,t),G(e,"RootPersistencyFolder",!0,t),t}function te(e){var t={};if("TransferData"!=e.tagName)throw new Error("TransferData node expected!");var n={};G(e,"screenx",!1,n,"screenX"),G(e,"screeny",!1,n,"screenY");var r=a(n.screenX,"string")&&n.screenX,i=a(n.screenY,"string")&&n.screenY;(r||i)&&(r&&(n.screenX=JSON.parse(n.screenX)),i&&(n.screenY=JSON.parse(n.screenY)),t.mouse=n);for(var o=0;o<e.childNodes.length;o++){var s=e.childNodes.item(o);switch(s.nodeName){case"Data":var c=s.getAttribute("type");if("ContextData"==c||"PersistData"==c)for(var u=0;u<s.childNodes.length;u++){var f=s.childNodes.item(u);switch(f.nodeName){case"Entities":if("ContextData"!=c)throw new Error("ContextData data type expected instead of "+c);t.entities=q(f);break;case"PersistData":if("PersistData"!=c)throw new Error("PersistData data type expected instead of "+c);t.archive=$(f)}}break;case"Entities":t.entities=q(s)}}return t}function ne(e){var t=JSON.parse(e);if("boolean"!=typeof t)throw new Error("Invalid boolean value specified: "+e);return t}function re(e){var t={},n=e.split(","),r=new RegExp("^[0-9]+,[0-9]+$");if(!r.test(e)||2!=n.length)throw new Error("Invalid data format used!");return t.x=JSON.parse(n[0]),t.y=JSON.parse(n[1]),t}var ie=e.DOMParser?new e.DOMParser:null;return{toMap:{onLog:{format:function(e){return W("Log",e)}},onContextMenu:{format:function(e){return l("EventData",e)}},onContextChange:{format:function(e){return h("Entities",e)}},onContextDragStart:{format:function(e){return h("Entities",e)}},onDragStart:{format:function(e){return J("TransferData",e)}},onNavigate:{format:function(e){return F("Navigation",e)}},onCopy:{format:function(e){return J("TransferData",e)}},onToast:{format:function(e){return B("Toast",e)}},onPropertyChange:{format:function(e){return k("Properties",e)}},onLoad:{format:function(e){return R("Description",e)}},onUnload:{format:function(e){return O("PersistData",e)}},persistdata:{format:function(e){return O("PersistData",e)}},onUpdateCommandBars:{format:function(e){return N("UpdateCommandBars",e)}},onCopyToClipboard:{format:function(e){return U("ClipboardData",e)}},onSaveToStore:{format:function(e){return X("StoreData",e)}},onResize:{format:function(e){return f("Location",e)}},Session:{format:function(e){return H("Session",e)}},toTransferData:{format:function(e){return J("TransferData",e)}}},fromMap:{onContextChange:{format:function(e){return q(K(e))}},onPropertyChange:{format:function(e){return z(K(e))}},onCommand:{format:function(e){return V(K(e))}},ActiveSymbol:{format:function(e){return q(K(e))}},Description:{format:function(e){return Q(K(e))}},UserInfo:{format:function(e){return Z(K(e))}},"x,y":{format:function(e){return re(e)}},Boolean:{format:function(e){return ne(e)}},ContainerInformation:{format:function(e){return ee(K(e))}},persistdata:{format:function(e){return $(K(e))}},fromTransferData:{format:function(e){return te(K(e))}}}}}t.exports=r},{}],8:[function(e,t,n){function r(e,t){e.setLogOptions=function(t){o=void 0===t||null===t?10:t,s.forEach(function(t,n){e[t]=a(n)})},e.setLogOptions(o),t?(e.log=function(t){e._processEvent(window,{name:"onLog",data:t})},u.forEach(function(t){e[t]=function(n){e.log({messages:[{severity:t,text:n,source:c}]})}}),e.loggingSource=function(e){c=e}):e.log=function(){i(arguments)}}function i(){for(var e=[],t=arguments.length,n=0;n<t;n++)e.push(arguments[n]);e=e.map(function(e){return"function"==typeof e?e():"string"==typeof e?e:e?Array.isArray(e)?e.join(" "):JSON.stringify(e):""}),console.log(e.join(""))}function a(e){return o<=e?function(){i.apply(this,arguments)}:function(){}}var o=2,s=["trace","debug","info","warn","error"],c="",u=["debug","information","warning","high","critical"];t.exports=function(e,t){if("undefined"==typeof e)throw new Error("tried to initialize a logger with undefined.");r(e,t)}},{}],9:[function(e,t,n){function r(e){return!(!e||!e.lastIndexOf||0!==e.lastIndexOf("acs--jet--",0))}function i(e,t){t=t||{},this._parsers=[],this.name=Math.floor(1e3*Math.random())+1+"(acs_master)",this.promiseHandler=s(this.name),this._isACS=!0,o=t.frameManager;var n=o.getWindow();a=t.frameManager.getFrame(),t.sameWindowStrategy?(n.__ACSMessageShim__=this._messageHandlerSameWindow.bind(this),this.sendMessage=function(e,t){if(t=t||{},!n.__JETMessageShim__)throw new Error("ACS could not find the JETMessageShim.");n.__JETMessageShim__(e,t)}):(this.init(e),this.sendMessage=function(e,t){t=t||{},e.postMessage(this._makeMessage(t),"*")}),this.sendPromise=function(e,t){t=t||{};var n=this.promiseHandler.makePromise();return t.promiseIndex=n,this.sendMessage(e,t),this.promiseHandler.getDeferred(n)}}var a,o,s=e("./PromiseHandler");i.prototype={init:function(e){return this.source=e,this.boundOnMessage=this._messageHandler.bind(this),this.source.addEventListener&&this.source.addEventListener("message",this.boundOnMessage,!1),this.source.attachEvent&&this.source.attachEvent("onmessage",this.boundOnMessage,!1),this},dispose:function(){this.source.removeEventListener&&this.source.removeEventListener("message",this.boundOnMessage,!1),this.source.detachEvent&&this.source.detachEvent("onmessage",this.boundOnMessage,!1),this.promiseHandler.dispose()},addStringToParser:function(e){this._parsers.push(e)},_parseData:function(e){var t=this._parsers,n=t.length;if(n>0)for(var r=0;r<n;r++){var i=t[r];if("[object String]"===Object.prototype.toString.call(e)){if(e.match(i)){e=e.replace(i,"");try{return JSON.parse(e)}catch(e){return}}}else if("object"==typeof e)return e}else try{return JSON.parse(e)}catch(t){return e}},_makeMessage:function(e){e=e||{};var t="";return e.parseKey&&(t+=e.parseKey),t+JSON.stringify({params:e.params,promiseIndex:e.promiseIndex,funcName:e.funcName,parseKey:e.parseKey,senderId:"acs--jet--"+this.name,attachSource:e.attachSource,name:this.name})},_messageHandler:function(e){var t=(e.source,e.origin,this._parseData(e.data));t&&!t.targetId?t.funcName&&this._handleMessage(e.source,t):t&&r(t.senderId)&&this._handleEikonMessage(t)},_messageHandlerSameWindow:function(e,t){t.targetId?r(t.senderId)&&this._handleEikonMessage(t):t.funcName&&this._handleMessage(e,t)},_handleMessage:function(e,t){function n(t){t=t||{},t.parseKey="jet:msg",r.sendMessage(e,t)}var r=this,i=t.funcName,a=t.params,o=t.promiseIndex,s=t.attachSource;switch(i){case"handshake":this.sendMessage(e,{promiseIndex:o,parseKey:t.parseKey,funcName:"replyHandshake"});break;case"replyHandshake":this.promiseHandler.resolvePromise(o,!0);break;case"replyPromiseResolve":this.promiseHandler.resolvePromise(o,a);break;case"replyPromiseReject":this.promiseHandler.rejectPromise(o,a);break;case"setRegisterData":this.registerData=t.params,this.topAppInstanceId=this.registerData.instanceId,this.topAppAppId=this.registerData.appId,delete this.registerData.instanceId,delete this.registerData.appId;break;case"getRegisterData":this.registerData&&o?this.sendMessage(e,{promiseIndex:o,parseKey:t.parseKey,funcName:"replyRegisterData",params:this.registerData}):this.sendMessage(e,{parseKey:t.parseKey,funcName:"replyRegisterData"});break;case"replyRegisterData":a?this.promiseHandler.resolvePromise(o,a):this.promiseHandler.rejectPromise(o,!1);break;default:if(s&&a.unshift(e),o){var c,u;u=this.__getFunc(i),u&&(c=u[i],"function"==typeof c&&c.apply(u,a).then(function(t){var r={funcName:"replyPromiseResolve",source:e,params:t,promiseIndex:o};n(r)},function e(e){var t={funcName:"replyPromiseReject",params:[e.toString(),e.stack],promiseIndex:o};n(t)}))}else u=this.__getFunc(i),u&&(c=u[i],"function"==typeof c&&c.apply(u,a))}},_handleEikonMessage:function(e){this._isACS?this._isACS._onProcessEvent(e):this.sendMessage(a,{parseKey:"jet:msg",params:[e.data],attachSource:!0,funcName:"_onProcessEventWithSource"})},__namespaces__:[],registerNamespace:function(e){this.__namespaces__.push(e)},__getFunc:function(e){for(var t=void 0,n=this.__namespaces__,r=n.length,i=0;i<r;i++){var a=n[i];if(a[e]){t=a;break}}return t}},t.exports=i},{"./PromiseHandler":10}],10:[function(e,t,n){t.exports=function(e){var t=1,n=e,r={},i={};return{dispose:function(){r=null,i=null},makePromise:function(){var e=t++ +"_"+n;return r[e]=new Promise(function(t,n){i[e]={resolve:t,reject:n}}),e},getDeferred:function(e){return i[e]},getPromise:function(e){return r[e]},cleanPromise:function(e,t){i[e]=t,r[e]=t},resolvePromise:function(e,t){var n=this.getDeferred(e);n&&n.resolve&&(n.resolve(t),this.cleanPromise(e,"resolved"))},rejectPromise:function(e,t){var n=this.getDeferred(e);n&&n.reject&&(n.reject(t),this.cleanPromise(e,"rejected"))}}}},{}],11:[function(e,t,n){function r(e){return function(){return function(){return a[e]}}}function i(e){return function(t){a[e]=t}}var a={properties:{},persistdata:[]},o={};Object.defineProperties(o,{helpurl:{get:r("helpurl"),set:i("helpurl")},context:{get:r("context"),set:i("context")},properties:{get:r("properties"),set:i("properties")},description:{get:r("description"),set:i("description")},persistdata:{get:r("persistdata"),set:i("persistdata")},inputowners:{get:r("inputowners"),set:i("inputowners")}}),t.exports=function(){return{dataProviders:o}}},{}],12:[function(e,t,n){function r(e){var t;try{t=e.navigator.userAgent}catch(e){t="???"}return t}function i(e){return e.indexOf("EikonViewer")>-1}t.exports=function(e){function t(t){return o=t?e.top:e}function n(){var t;try{t=e.self!==e.top}catch(e){t=!1}i(a)||(t=!1),s=t}var a=r(e),o=void 0,s=void 0;return n(),t(s),{setOnFrame:function(e,t,n){o[e]&&!n||(o[e]=t)},getFrame:function(){return o},getWindow:function(){return e},inFrame:function(){return s},isDesktop:function(){return i(a)}}}},{}],13:[function(e,t,n){(function(t,n){function r(){return"object"==typeof t&&t+""=="[object process]"}function i(){return r()?n.aWindow:window}window.Promise||(window.Promise=e("promise-polyfill"));var a=i(),o=e("./MessageManager"),s=e("./frameManager"),c=s(i()),u=(c.getFrame(),e("./AppContainerShim")),f=e("./AppContainerShimFactory");f({MessageManager:o,frameManager:c,ACS:u,aWindow:i(),eikonNow:a.EikonNow})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./AppContainerShim":4,"./AppContainerShimFactory":5,"./MessageManager":9,"./frameManager":12,_process:1,"promise-polyfill":2}],14:[function(e,t,n){t.exports={addEventToSource:function(e,t,n){this.addEvent(e,"message",n)},removeEventFromSource:function(e,t,n){this.removeEvent(e,"message",n)},removeEvent:function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1),e.detachEvent&&e.detachEvent("on"+t,n,!1)},addEvent:function(e,t,n){e.addEventListener&&e.addEventListener(t,n,!1),e.attachEvent&&e.attachEvent("on"+t,n,!1)}}},{}]},{},[13]);
//# sourceMappingURL=acs.min.js.map